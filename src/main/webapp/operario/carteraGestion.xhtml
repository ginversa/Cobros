<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="title">Gestión</ui:define>

    <ui:define name="viewname">
        <li><p:link outcome="/operario/cartera">Mi Cartera</p:link></li>
        <li>/</li>
        <li>Gestión</li>
    </ui:define>

    <ui:param name="viewname" value="Gestión" />

    <ui:define name="content">
        <h:form id="formGestion">
            <div class="p-grid">
                <div class="p-col-12 p-md-12">
                    <p:growl id="messages" showDetail="true" showSummary="true" severity="info,fatal" >
                        <p:autoUpdate/>
                    </p:growl>                        
                    <p:tabView id="idTabView" >
                        <p:ajax event="tabChange" listener="#{findmeController.onTabViewChange}" />
                        <p:tab title="Gestión">                            
                            <div class="card">
                                <h1>Gestión</h1>
                                <p>Sistema de Cobros.</p>
                                <!-- class="ui-fluid" -->
                                <p:panelGrid id="pgInfoGestion" columns="1" layout="grid">
                                    <p:toolbar styleClass="">
                                        <f:facet name="right">
                                            <h:panelGrid columns="3">
                                                <p:selectOneMenu id="txtPrefijo" value="#{carteraGestionController.prefijoSalidaSelected}" converter="prefijoSalidaConverter" required="true" requiredMessage="Prefijo Salida requerido!" styleClass="secondary-button p-mr-2 p-mb-2" >
                                                    <f:selectItem itemLabel="--- Prefijo Salida ---" itemValue="" noSelectionOption="true" />
                                                    <f:selectItems value="#{carteraGestionController.prefijoSalidaList}" var="prefijoSalida" itemLabel="#{prefijoSalida.prefijo} - #{prefijoSalida.nombre}" itemValue="#{prefijoSalida}" />
                                                    <p:ajax listener="#{carteraGestionController.onPrefijoSalidaChange()}" event="change" />
                                                </p:selectOneMenu>
                                                <p:commandButton value="Agregar Teléfono" update="formGestion:manage-Telefono-content" oncomplete="PF('manageTelefonoDialog').show()" process="@this" styleClass="p-mr-2 p-mb-2"/>
                                                <p:commandButton value="Finalizar" actionListener="#{carteraGestionController.finalizarGestion()}" process="@this formGestion:idTabView:pgDeudor" update="formGestion:messages" styleClass="success-button p-mr-2 p-mb-2" />
                                            </h:panelGrid>
                                        </f:facet>
                                    </p:toolbar>

                                    <p:panelGrid id="pgDeudor" columns="5" layout="grid">
                                        <p:panelGrid columns="2" >
                                            <p:outputLabel for="txtCartera" value="Cartera" />
                                            <h:outputText id="txtCartera" value="#{carteraGestionController.gestion.codigoCartera}" />

                                            <p:outputLabel for="txtDocumento" value="Identificación" />
                                            <h:outputText id="txtDocumento" value="#{carteraGestionController.gestion.identificacion}" />

                                            <p:outputLabel for="txtNombre" value="Nombre" />
                                            <h:outputText id="txtNombre" value="#{carteraGestionController.gestion.nombreCliente}" />

                                            <p:outputLabel for="txtOperacion" value="Operación" />
                                            <h:outputText id="txtOperacion" value="#{carteraGestionController.gestion.operacion}" />
                                        </p:panelGrid>

                                        <p:panelGrid columns="2">
                                            <p:outputLabel for="txtSaldoColones" value="Saldo Colones" />
                                            <h:outputText id="txtSaldoColones" value="#{carteraGestionController.selectedCartera.saldoColones}" >
                                                <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                            </h:outputText>
                                            <p:outputLabel for="txtInteresesColones" value="Intereses Colones" />
                                            <h:outputText id="txtInteresesColones" value="#{carteraGestionController.selectedCartera.interesesColones}" >
                                                <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                            </h:outputText>
                                            <p:outputLabel for="txtLeyUsura" value="Ley Usura" />
                                            <p:selectOneMenu id="txtLeyUsura" disabled="true" value="#{carteraGestionController.gestion.leyusura}" >
                                                <f:selectItem itemLabel="--- Si ---" itemValue="1" />
                                                <f:selectItem itemLabel="--- No ---" itemValue="0" />
                                            </p:selectOneMenu>                                            
                                            <p:outputLabel for="txtSaldo" value="Saldo a cobrar" />
                                            <p:inputNumber id="txtSaldo" value="#{carteraGestionController.gestion.mtosaldocobrar}" symbol="₡" symbolPosition="p" decimalSeparator="." thousandSeparator="," decimalPlaces="2" maxlength="18" disabled="#{carteraGestionController.leyusuraDisabled}" required="#{carteraGestionController.leyusuraIsRequired}" requiredMessage="Saldo a cobrar, requerido!" />
                                        </p:panelGrid>

                                        <p:panelGrid columns="2" >
                                            <p:outputLabel for="txtSaldoDolares" value="Saldo Dolares" />
                                            <h:outputText id="txtSaldoDolares" value="#{carteraGestionController.selectedCartera.saldoDolares}" >
                                                <f:convertNumber type="currency" currencySymbol="$" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                            </h:outputText>

                                            <p:outputLabel for="txtInteresesDolares" value="Intereses Dolares" />
                                            <h:outputText id="txtInteresesDolares" value="#{carteraGestionController.selectedCartera.interesesDolares}" >
                                                <f:convertNumber type="currency" currencySymbol="$" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                            </h:outputText>

                                            <p:outputLabel for="txtFechaUltimoPago" value="Fecha Último Pago" />
                                            <p:calendar id="txtFechaUltimoPago" pattern="dd/MM/yyyy" readonly="true" disabled="true" />

                                            <p:outputLabel for="txtMontoUltimoPago" value="Monto Último Pago" />
                                            <h:outputText id="txtMontoUltimoPago" >
                                                <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                            </h:outputText>
                                        </p:panelGrid>

                                        <p:panelGrid columns="2" >
                                            <p:outputLabel for="txtFechaUltimoPromesa" value="Fecha Último Promesa" />
                                            <p:calendar id="txtFechaUltimoPromesa" pattern="dd/MM/yyyy" value="#{carteraGestionController.selectedCartera.fechaUltimaPromesa}" readonly="true" disabled="true" />

                                            <p:outputLabel for="txtMontoUltimoPromesa" value="Monto Último Promesa" />
                                            <h:outputText id="txtMontoUltimoPromesa" value="#{carteraGestionController.selectedCartera.montoUltimaPromesa}" >
                                                <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                            </h:outputText>
                                            <p:outputLabel for="txtRazonMora" value="Última Razón Mora" />
                                            <h:outputText id="txtRazonMora" value="#{carteraGestionController.selectedCartera.razonMora}" >
                                                <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                            </h:outputText>
                                            <p:outputLabel for="txtdescripcion" value="Observación" />
                                            <p:inputTextarea id="txtdescripcion" value="#{carteraGestionController.gestion.descripcion}" />                                        
                                        </p:panelGrid>                                                                       
                                    </p:panelGrid>

                                    <p:fieldset legend="Llamar" class="ui-fluid" >                                        
                                        <!-- paginator="true" paginatorPosition="top" rows="5" -->
                                        <p:dataTable id="tblTelefono" value="#{carteraGestionController.llamadaList}" var="llamada"
                                                     editMode="cell" editable="true" widgetVar="tblTelefono"                                                     
                                                     reflow="true"
                                                     styleClass="ui-datatable-striped ui-datatable-sm ui-datatable-gridlines"
                                                     style="margin-bottom:20px"
                                                     emptyMessage="No se encontraron registros." >

                                            <p:ajax event="cellEdit" listener="#{carteraGestionController.onCellEdit}" update="formGestion:messages" />

                                            <p:column exportable="false">
                                                <p:commandButton class="warning-button rounded-button" icon="pi pi-trash" process="@this" oncomplete="PF('deleteTelefonoDialog').show()" title="Eliminar Teléfono!"  >
                                                    <f:setPropertyActionListener value="#{llamada}" target="#{carteraGestionController.selectedLlamada}" />
                                                </p:commandButton>
                                            </p:column>                                    
                                            <p:column headerText="Teléfono" >                                        
                                                <p:commandLink value="#{llamada.callToNumber}" actionListener="#{carteraGestionController.generarLlamada(llamada)}" process="@this" >
                                                    <f:setPropertyActionListener value="#{llamada}" target="#{carteraGestionController.selectedLlamada}" />
                                                </p:commandLink>                                        
                                            </p:column>
                                            <p:column headerText="Tipo Teléfono" >
                                                <p:cellEditor>
                                                    <f:facet name="output">                                                
                                                        <h:outputText value="#{llamada.idTipotelefono}" />
                                                    </f:facet>
                                                    <f:facet name="input">
                                                        <h:selectOneMenu id="idTipoTelefono" value="#{llamada.idTipotelefono}" converter="tipoTelefonoConverter" required="true" requiredMessage="Tipo Teléfono requerido!" >
                                                            <f:selectItem itemLabel="---------------" itemValue="" noSelectionOption="true" />
                                                            <f:selectItems value="#{tipotelefonoController.tipotelefonoList}" var="tipoTelefono" itemLabel="#{tipoTelefono.descripcion}" itemValue="#{tipoTelefono}" />
                                                        </h:selectOneMenu>
                                                    </f:facet>
                                                </p:cellEditor>
                                            </p:column>
                                            <p:column headerText="Tipificación">
                                                <p:cellEditor>
                                                    <f:facet name="output"><h:outputText value="#{llamada.idTipificacion}" /></f:facet>
                                                    <f:facet name="input">
                                                        <h:selectOneMenu id="idTipificacion" value="#{llamada.idTipificacion}" converter="tipificacionConverter" required="true" requiredMessage="Tipificación requerido!" >
                                                            <f:selectItem itemLabel="----------------------------------------" itemValue="" noSelectionOption="true" />
                                                            <f:selectItems value="#{tipificacionController.tipificacionList}" var="tipificacion" itemLabel="#{tipificacion.descripcion}" itemValue="#{tipificacion}" />
                                                            <p:ajax listener="#{tipificacionController.onTipificacionChange(llamada)}" event="change" update="txtSubTipificacion, txtResultadogestion, txtidResultadotercero, btnPromesa" process="@this btnPromesa" />
                                                        </h:selectOneMenu>
                                                    </f:facet>
                                                </p:cellEditor>
                                            </p:column>
                                            <p:column headerText="Sub-Tipificación">
                                                <p:cellEditor>
                                                    <f:facet name="output"><h:outputText value="#{llamada.idSubtipificacion}" /></f:facet>
                                                    <f:facet name="input">
                                                        <h:selectOneMenu id="txtSubTipificacion" value="#{llamada.idSubtipificacion}" converter="subtipificacionConverter" required="true" requiredMessage="Sub-Tipificación requerido!" >
                                                            <f:selectItem itemLabel="----------------------------------------" itemValue="" noSelectionOption="true" />
                                                            <f:selectItems value="#{tipificacionController.subtipificacionList}" var="subtipificacion" itemLabel="#{subtipificacion.descripcion}" itemValue="#{subtipificacion}" />
                                                        </h:selectOneMenu>
                                                    </f:facet>
                                                </p:cellEditor>
                                            </p:column>
                                            <p:column headerText="Resultado Gestión">
                                                <p:cellEditor>
                                                    <f:facet name="output"><h:outputText value="#{llamada.idResultadogestion}" /></f:facet>
                                                    <f:facet name="input">
                                                        <h:selectOneMenu id="txtResultadogestion" value="#{llamada.idResultadogestion}" converter="resultadogestionConverter" >
                                                            <f:selectItem itemLabel="----------------------------------------" itemValue="" noSelectionOption="true" />
                                                            <f:selectItems value="#{tipificacionController.resultadogestionList}" var="resultadogestion" itemLabel="#{resultadogestion.descripcion}" itemValue="#{resultadogestion}" />
                                                            <p:ajax listener="#{tipificacionController.onResultadogestionChange(llamada)}" event="change" update="txtidResultadotercero" process="@this" />
                                                        </h:selectOneMenu>
                                                    </f:facet>
                                                </p:cellEditor>
                                            </p:column>
                                            <p:column headerText="Respuesta">
                                                <p:cellEditor>
                                                    <f:facet name="output"><h:outputText value="#{llamada.idResultadotercero}" /></f:facet>
                                                    <f:facet name="input">
                                                        <h:selectOneMenu id="txtidResultadotercero" value="#{llamada.idResultadotercero}" converter="resultadoterceroConverter" >
                                                            <f:selectItem itemLabel="----------------------------------------" itemValue="" noSelectionOption="true" />
                                                            <f:selectItems value="#{tipificacionController.resultadoterceroList}" var="resultadotercero" itemLabel="#{resultadotercero.descripcion}" itemValue="#{resultadotercero}" />
                                                        </h:selectOneMenu>
                                                    </f:facet>
                                                </p:cellEditor>
                                            </p:column>
                                            <p:column headerText="Razón Mora">
                                                <p:cellEditor>
                                                    <f:facet name="output"><h:outputText value="#{llamada.idrazonmora}" /></f:facet>
                                                    <f:facet name="input">
                                                        <h:selectOneMenu id="txtRazonMora" value="#{llamada.idrazonmora}" converter="razonmoraConverter" required="true" requiredMessage="Razón Mora requerido!" >
                                                            <f:selectItem itemLabel="----------------------------------------" itemValue="" noSelectionOption="true" />
                                                            <f:selectItems value="#{razonmoraController.razonmoraList}" var="razonMora" itemLabel="#{razonMora.descripcion}" itemValue="#{razonMora}" />
                                                        </h:selectOneMenu>
                                                    </f:facet>
                                                </p:cellEditor>
                                            </p:column>
                                            <p:column headerText="Promesa" >
                                                <p:commandButton id="btnPromesa" title="Agregar Promesa" icon="pi pi-user" styleClass="warning-button rounded-button p-mr-2 p-mb-2" oncomplete="PF('manageLlamarPromesaArregloPagoDialog').show()" process="@this :formGestion:idTabView:pgDeudor" update="formGestion:manage-llamarPromesaArregloPago-content" disabled="#{tipificacionController.isDisabledPromesa}" >
                                                    <f:setPropertyActionListener value="#{llamada}" target="#{carteraGestionController.selectedLlamada}"  />
                                                </p:commandButton>
                                            </p:column>
                                            <p:column headerText="Guardar" >
                                                <p:commandButton actionListener="#{carteraGestionController.finalizarGestion()}" title="Guardar Gestión" icon="pi pi-check" styleClass="success-button rounded-button p-mr-2 p-mb-2" process="@this formGestion:idTabView:pgDeudor" update="formGestion:messages" />
                                            </p:column>                                          
                                        </p:dataTable> 
                                    </p:fieldset>
                                </p:panelGrid>

                                <p:fieldset legend="Operaciones">
                                    <p:dataTable id="tblOperaciones" value="#{carteraGestionController.carteraList}" var="cartera"
                                                 selectionMode="single" selection="#{carteraGestionController.selectedCartera}" rowKey="#{cartera.id}"
                                                 widgetVar="tblOperaciones"
                                                 reflow="true"
                                                 styleClass="ui-datatable-striped ui-datatable-sm ui-datatable-gridlines"
                                                 style="margin-bottom:20px"
                                                 emptyMessage="No se encontraron registros." >

                                        <p:ajax event="rowSelect" listener="#{carteraGestionController.onRowSelect}" update=":formGestion:messages, :formGestion:idTabView:pgDeudor"/>
                                        <p:ajax event="rowUnselect" listener="#{carteraGestionController.onRowUnselect}" update=":formGestion:messages, :formGestion:idTabView:pgDeudor"/>

                                        <p:column headerText="Operación" filterBy="#{cartera.numeroCuenta}" filterMatchMode="contains" sortBy="#{cartera.numeroCuenta}" >
                                            <h:outputText value="#{cartera.numeroCuenta}" />                                
                                        </p:column>
                                        <p:column headerText="Saldo Colones" filterBy="#{cartera.saldoColones}" sortBy="#{cartera.saldoColones}" >
                                            <h:outputText value="#{cartera.saldoColones}">
                                                <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Intereses Colones" filterBy="#{cartera.interesesColones}" sortBy="#{cartera.interesesColones}" >
                                            <h:outputText value="#{cartera.interesesColones}">
                                                <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Saldo Dolares" filterBy="#{cartera.saldoDolares}" sortBy="#{cartera.saldoDolares}" >
                                            <h:outputText value="#{cartera.saldoDolares}">
                                                <f:convertNumber type="currency" currencySymbol="$" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Intereses Dolares" filterBy="#{cartera.interesesDolares}" sortBy="#{cartera.interesesDolares}" >
                                            <h:outputText value="#{cartera.interesesDolares}">
                                                <f:convertNumber type="currency" currencySymbol="$" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Última Gestión" filterBy="#{cartera.fechaUltimaGestion}" sortBy="#{cartera.fechaUltimaGestion}" >
                                            <h:outputText value="#{cartera.fechaUltimaGestion}" >
                                                <f:convertDateTime pattern="dd/MM/yyyy" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Última Promesa" filterBy="#{cartera.fechaUltimaPromesa}" sortBy="#{cartera.fechaUltimaPromesa}" >
                                            <h:outputText value="#{cartera.fechaUltimaPromesa}" >
                                                <f:convertDateTime pattern="dd/MM/yyyy" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Última Promesa" filterBy="#{cartera.montoUltimaPromesa}" sortBy="#{cartera.montoUltimaPromesa}" >
                                            <h:outputText value="#{cartera.montoUltimaPromesa}" >                                            
                                                <f:convertNumber type="currency" currencySymbol="#{cartera.idMonedaDolares.simbolo}" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Razón Mora" filterBy="#{cartera.razonMora}" sortBy="#{cartera.razonMora}" >
                                            <h:outputText value="#{cartera.razonMora}" />
                                        </p:column>                                        
                                    </p:dataTable>
                                </p:fieldset>

                            </div>
                        </p:tab>
                        <p:tab title="Findme">
                            <p:commandButton value="Imprimir" type="button" icon="pi pi-print" style="margin-bottom: 2rem">
                                <p:printer target="pgFindme" />
                            </p:commandButton>
                            <div class="card">
                                <p:panelGrid id="pgFindme" columns="1" layout="grid">
                                    <h2>Datos adicionales para la gestión.</h2>
                                    <p>Localización. Según Findme</p>
                                    <p:panelGrid id="pgHistorial" columns="3" layout="grid">
                                        <p:fieldset legend="Teléfonos" >
                                            <p:dataTable id="idHistorialTelefonos" value="#{findmeController.historialTelefonoList}" var="historialTelefono"
                                                         style="margin-bottom:20px" emptyMessage="No se encontraron registros."
                                                         reflow="true"
                                                         styleClass="ui-datatable-striped ui-datatable-sm ui-datatable-gridlines" >

                                                <p:column headerText="Teléfono" >
                                                    <p:commandLink value="#{historialTelefono.telefono}" actionListener="#{findmeController.generarLlamada(historialTelefono)}" process="@this" >
                                                        <f:setPropertyActionListener value="#{historialTelefono}" target="#{findmeController.selectedHistorialTelefono}" />
                                                    </p:commandLink>
                                                </p:column>
                                            </p:dataTable>
                                        </p:fieldset>
                                        <p:fieldset legend="Correos" >
                                            <p:dataTable id="idHistorialCorreo" value="#{findmeController.historialCorreoList}" var="historialCorreo"
                                                         style="margin-bottom:20px" emptyMessage="No se encontraron registros."
                                                         reflow="true"
                                                         styleClass="ui-datatable-striped ui-datatable-sm ui-datatable-gridlines" >

                                                <p:column headerText="Correo">
                                                    <h:outputText value="#{historialCorreo.correo}" />
                                                </p:column>
                                            </p:dataTable>
                                        </p:fieldset>
                                        <p:fieldset legend="Direcciones" >
                                            <p:dataTable id="idHistorialDireccion" value="#{findmeController.historialDireccionList}" var="historialDireccion"
                                                         style="margin-bottom:20px" emptyMessage="No se encontraron registros."
                                                         reflow="true"
                                                         styleClass="ui-datatable-striped ui-datatable-sm ui-datatable-gridlines" >

                                                <p:column headerText="Tipo">
                                                    <h:outputText value="#{historialDireccion.tipo}" />
                                                </p:column>                                        
                                                <p:column headerText="Dirección">
                                                    <h:outputText value="#{historialDireccion.direccion}" />
                                                </p:column>
                                            </p:dataTable>
                                        </p:fieldset>
                                    </p:panelGrid>

                                    <p:fieldset legend="Árbol Familiar" >
                                        <p:dataTable id="idArbolFamiliar" value="#{findmeController.arbolFamiliarList}" var="arbolFamiliar"
                                                     style="margin-bottom:20px" emptyMessage="No se encontraron registros."
                                                     reflow="true"
                                                     styleClass="ui-datatable-striped ui-datatable-sm ui-datatable-gridlines" >

                                            <p:column headerText="Nombre">
                                                <h:outputText value="#{arbolFamiliar.nombre}" />
                                            </p:column>                                        
                                            <p:column headerText="Parentesco">
                                                <h:outputText value="#{arbolFamiliar.parentesco}" />
                                            </p:column>
                                            <p:column headerText="Teléfono">
                                                <h:outputText value="#{arbolFamiliar.telefonos}" />
                                            </p:column>
                                        </p:dataTable>
                                    </p:fieldset>

                                    <p:fieldset legend="Análisis Laboral" >
                                        <p:dataTable id="idAnalisisLaboral" value="#{findmeController.historialLaboralList}" var="historialLaboral"                                                 
                                                     style="margin-bottom:20px" emptyMessage="No se encontraron registros."
                                                     reflow="true"
                                                     styleClass="ui-datatable-striped ui-datatable-sm ui-datatable-gridlines" >

                                            <p:column headerText="Estatus">
                                                <h:outputText value="#{historialLaboral.estatus}" />
                                            </p:column>
                                            <p:column headerText="Cédula Patrono">
                                                <h:outputText value="#{historialLaboral.cedula_patrono}" />
                                            </p:column>
                                            <p:column headerText="Nombre">
                                                <h:outputText value="#{historialLaboral.nombre}" />
                                            </p:column>
                                            <p:column headerText="Último Salario">
                                                <h:outputText value="#{historialLaboral.ultimo_salario}" >
                                                    <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Último Periodo">
                                                <h:outputText value="#{historialLaboral.ultimo_periodo}" />
                                            </p:column>
                                            <p:column headerText="Meses">
                                                <h:outputText value="#{historialLaboral.meses}" />
                                            </p:column>
                                            <p:column headerText="Promedio">
                                                <h:outputText value="#{historialLaboral.promedio}" >
                                                    <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Tipo Salario">
                                                <h:outputText value="#{historialLaboral.tipo_salario}" />
                                            </p:column>
                                        </p:dataTable>
                                    </p:fieldset>

                                    <p:fieldset legend="Sociedades Anónimas" >
                                        <p:dataTable id="idSociedadAnonima" value="#{findmeController.sociedadAnonimaList}" var="sociedadAnonima"
                                                     style="margin-bottom:20px" emptyMessage="No se encontraron registros."
                                                     reflow="true"
                                                     styleClass="ui-datatable-striped ui-datatable-sm ui-datatable-gridlines" >

                                            <p:column headerText="Posición">
                                                <h:outputText value="#{sociedadAnonima.posicion}" />
                                            </p:column>                                        
                                            <p:column headerText="Nombre Sociedad">
                                                <h:outputText value="#{sociedadAnonima.nombre_sociedad}" />
                                            </p:column>
                                            <p:column headerText="Cédula Jurídica">
                                                <h:outputText value="#{sociedadAnonima.cedula_juridica}" />
                                            </p:column>
                                            <p:column headerText="Dirección">
                                                <h:outputText value="#{sociedadAnonima.direccion}" />
                                            </p:column>
                                            <p:column headerText="Teléfono">
                                                <h:outputText value="#{sociedadAnonima.telefono}" />
                                            </p:column>
                                            <p:column headerText="Fax">
                                                <h:outputText value="#{sociedadAnonima.fax}" />
                                            </p:column>
                                            <p:column headerText="Verificado">
                                                <h:outputText value="#{sociedadAnonima.verificado}" />
                                            </p:column>
                                        </p:dataTable>
                                    </p:fieldset>

                                    <p:fieldset legend="Bienes Inmuebles" >
                                        <p:dataTable id="idPropiedadRegistrada" value="#{findmeController.propiedadRegistradaList}" var="propiedadRegistrada"
                                                     style="margin-bottom:20px" emptyMessage="No se encontraron registros."
                                                     reflow="true"
                                                     styleClass="ui-datatable-striped ui-datatable-sm ui-datatable-gridlines" >

                                            <p:column headerText="Provincia">
                                                <h:outputText value="#{propiedadRegistrada.provincia}" />
                                            </p:column>                                        
                                            <p:column headerText="Cantón">
                                                <h:outputText value="#{propiedadRegistrada.canton}" />
                                            </p:column>
                                            <p:column headerText="Distrito">
                                                <h:outputText value="#{propiedadRegistrada.distrito}" />
                                            </p:column>
                                            <p:column headerText="Valor">
                                                <h:outputText value="#{propiedadRegistrada.valor}" >
                                                    <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="País">
                                                <h:outputText value="#{propiedadRegistrada.pais}" />
                                            </p:column>
                                        </p:dataTable>
                                    </p:fieldset>

                                    <p:fieldset legend="Vehículos" >
                                        <p:dataTable id="idVehiculo" value="#{findmeController.vehiculoList}" var="vehiculo"
                                                     style="margin-bottom:20px" emptyMessage="No se encontraron registros."
                                                     reflow="true"
                                                     styleClass="ui-datatable-striped ui-datatable-sm ui-datatable-gridlines" >

                                            <p:column headerText="Placa">
                                                <h:outputText value="#{vehiculo.placa}" />
                                            </p:column>                                        
                                            <p:column headerText="Año de Fabricación">
                                                <h:outputText value="#{vehiculo.ano_fabricacion}" />
                                            </p:column>
                                            <p:column headerText="Fabricante">
                                                <h:outputText value="#{vehiculo.marca}" />
                                            </p:column>
                                            <p:column headerText="Modelo">
                                                <h:outputText value="#{vehiculo.estilo}" />
                                            </p:column>
                                            <p:column headerText="Tipo">
                                                <h:outputText value="#{vehiculo.tipo}" />
                                            </p:column>                                            
                                            <p:column headerText="País">
                                                <h:outputText value="#{vehiculo.pais}" />
                                            </p:column>
                                            <p:column headerText="Antigüedad">
                                                <h:outputText value="#{vehiculo.antiguedad}" />
                                            </p:column>
                                        </p:dataTable>
                                    </p:fieldset>

                                    <p:fieldset legend="Historial Judicial" >
                                        <p:dataTable id="idHistorialJudicial" value="#{findmeController.historialJudicialList}" var="historialJudicial"
                                                     style="margin-bottom:20px" emptyMessage="No se encontraron registros."
                                                     reflow="true"
                                                     styleClass="ui-datatable-striped ui-datatable-sm ui-datatable-gridlines" >

                                            <p:column headerText="Expediente">
                                                <h:outputText value="#{historialJudicial.expediente}" />
                                            </p:column>                                        
                                            <p:column headerText="Asunto">
                                                <h:outputText value="#{historialJudicial.asunto}" />
                                            </p:column>
                                            <p:column headerText="Oficina">
                                                <h:outputText value="#{historialJudicial.oficina}" />
                                            </p:column>
                                            <p:column headerText="Caso">
                                                <h:outputText value="#{historialJudicial.caso}" />
                                            </p:column>
                                            <p:column headerText="Tipo Parte">
                                                <h:outputText value="#{historialJudicial.tipo_parte}" />
                                            </p:column>
                                            <p:column headerText="Fecha Caso">
                                                <h:outputText value="#{historialJudicial.fecha_caso}" >
                                                    <f:convertDateTime type="date" pattern="dd/MM/yyyy" />
                                                </h:outputText>                                                
                                            </p:column>
                                            <p:column headerText="Estado">
                                                <h:outputText value="#{historialJudicial.estado}" />
                                            </p:column>
                                            <p:column headerText="País">
                                                <h:outputText value="#{historialJudicial.pais}" />
                                            </p:column>
                                        </p:dataTable>
                                    </p:fieldset>
                                </p:panelGrid>
                            </div>                        
                        </p:tab>
                    </p:tabView>

                    <p:confirmDialog widgetVar="deleteTelefonoDialog" showEffect="fade" width="300" message="Eliminar este Teléfono?" header="Confirmar" severity="warn">
                        <p:commandButton value="Si" icon="pi pi-check" actionListener="#{carteraGestionController.deleteTelefono()}" process="@this" update="formGestion:idTabView:tblTelefono" oncomplete="PF('deleteTelefonoDialog').hide()" />
                        <p:commandButton value="No" type="button" styleClass="secondary-button" icon="pi pi-times" onclick="PF('deleteTelefonoDialog').hide()" />
                    </p:confirmDialog>


                    <p:dialog header="Agregar Teléfono" width="900" showEffect="fade" modal="true" widgetVar="manageTelefonoDialog" responsive="true" >
                        <p:outputPanel id="manage-Telefono-content" class="ui-fluid">
                            <p:outputPanel rendered='true'>
                                <div class="p-field">                                        
                                    <h:panelGrid id="pgTelefono01" columns="3">
                                        <p:outputLabel for="txtNonbreContacto" value="Nombre: " />
                                        <h:outputText id="txtNonbreContacto" value="#{carteraGestionController.contacto.nombre}" />
                                        <p:column />
                                        <p:outputLabel for="txtCedulaContacto" value="Identificación: " />
                                        <h:outputText id="txtCedulaContacto" value="#{carteraGestionController.contacto.cedula}" />
                                        <p:column />
                                        <p:outputLabel for="txtTelefonoContacto" value="Teléfono" />
                                        <p:inputMask id="txtTelefonoContacto" value="#{carteraGestionController.telefono.telefono}" mask="9999-9999" maxlength="45" required="true" requiredMessage="Teléfono requerido!" />
                                        <p:message for="txtTelefonoContacto" />
                                        <p:outputLabel for="txtTipotelefono" value="Tipo Teléfono" />
                                        <p:selectOneMenu id="txtTipotelefono" value="#{carteraGestionController.tipo}" converter="tipoTelefonoConverter" required="true" requiredMessage="Tipo Teléfono requerido!" >
                                            <f:selectItem itemLabel="--------------------" itemValue="" noSelectionOption="true" />
                                            <f:selectItems value="#{tipotelefonoController.tipotelefonoList}" var="tipoTelefono" itemLabel="#{tipoTelefono.descripcion}" itemValue="#{tipoTelefono}" />
                                        </p:selectOneMenu>
                                        <p:message for="txtTipotelefono" />
                                    </h:panelGrid>                              
                                </div>
                            </p:outputPanel>
                        </p:outputPanel>
                        <f:facet name="footer">    
                            <p:commandButton value="Save" icon="pi pi-check" actionListener="#{carteraGestionController.addTelefono()}" update="manage-Telefono-content, formGestion:idTabView:tblTelefono" process="manage-Telefono-content @this" ajax="true" />
                            <p:commandButton value="Cancel" icon="pi pi-times" onclick="PF('manageTelefonoDialog').hide()" class="secondary-button" />
                        </f:facet>
                    </p:dialog>

                    <p:dialog header="Promesa." width="1000" showEffect="fade" modal="true" widgetVar="manageLlamarPromesaArregloPagoDialog" responsive="true">
                        <p:outputPanel id="manage-llamarPromesaArregloPago-content" class="ui-fluid">
                            <p:outputPanel rendered='true'>
                                <div class="p-field">                                        
                                    <h:panelGrid id="pgLlamar02" columns="3">                                        
                                        <p:outputLabel for="txtNombrePromesa" value="Nombre" />
                                        <h:outputText id="txtNombrePromesa" value="#{carteraGestionController.gestion.nombreCliente}" />
                                        <p:column />                                        
                                        <p:outputLabel for="txtDocPromesa" value="Identificación" />
                                        <h:outputText id="txtDocPromesa" value="#{carteraGestionController.gestion.identificacion}" />
                                        <p:column />
                                        <p:outputLabel for="txtTelefonoPromesa" value="Teléfono" />
                                        <h:outputText id="txtTelefonoPromesa" value="#{carteraGestionController.selectedLlamada.callToNumber}" />
                                        <p:column />
                                    </h:panelGrid>

                                    <p:fieldset legend="Arreglo de pago" >
                                        <p:growl id="msgsArregloPago" showDetail="true"/>
                                        <p:tabView id="idtabViewPromesa">
                                            <p:tab id="idCancelacionTotal" title="Cancelación Total" >                                                
                                                <h:panelGrid id="idArreglodepago" columns="3">
                                                    <p:outputLabel for="txtOperacionPromesa" value="Operación" />
                                                    <h:selectOneMenu id="txtOperacionPromesa" value="#{carteraGestionController.clienteOperacion}" style="width:100%" >
                                                        <f:selectItem itemLabel="----------------------------------------" itemValue="" noSelectionOption="true" />
                                                        <f:selectItems value="#{carteraGestionController.carteraList}" var="cartera" itemLabel="#{cartera.numeroCuenta}" itemValue="#{cartera.numeroCuenta}" />
                                                        <p:ajax listener="#{carteraGestionController.onOperacionPromesaChange()}" event="change" update="txtSaldoOperacion, tblPromesaArregloPago" process="@this" />
                                                    </h:selectOneMenu>
                                                    <p:message for="txtOperacionPromesa" />

                                                    <p:outputLabel for="txtSaldoOperacion" value="Saldo" />
                                                    <h:outputText id="txtSaldoOperacion" value="#{carteraGestionController.mtoSaldoOperacion}">
                                                        <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                                    </h:outputText>
                                                    <p:message for="txtSaldoOperacion" />

                                                    <p:outputLabel for="txtTipoDescuento" value="Tipo Descuento" />
                                                    <h:selectOneMenu id="txtTipoDescuento" value="#{carteraGestionController.tipoDescuentoPromesa}" style="width:100%" >
                                                        <f:selectItem itemLabel="----------------------------------------" itemValue="" noSelectionOption="true" />
                                                        <f:selectItem itemLabel="Monto Fijo" itemValue="FIJ"/>
                                                        <f:selectItem itemLabel="Porcentaje" itemValue="POR"/>
                                                        <p:ajax listener="#{carteraGestionController.calcNuevoMontoSegunDescuento()}" event="change" update="txtNewSaldoPromesa" process="@this" />
                                                    </h:selectOneMenu>
                                                    <p:message for="txtTipoDescuento" />

                                                    <p:outputLabel for="txtDescuentoPromesa" value="Monto o %" />
                                                    <p:inputNumber id="txtDescuentoPromesa" value="#{carteraGestionController.mtoDescuentoPromesa}" decimalSeparator="." thousandSeparator="," decimalPlaces="2" maxlength="18" required="true" requiredMessage="Monto o % requerido!">
                                                        <p:ajax event="blur" update="txtNewSaldoPromesa" listener="#{carteraGestionController.calcNuevoMontoSegunDescuento()}"/>
                                                    </p:inputNumber>
                                                    <p:message for="txtDescuentoPromesa" />

                                                    <p:outputLabel for="txtNewSaldoPromesa" value="Monto Promesa" />
                                                    <p:inputText id="txtNewSaldoPromesa" value="#{carteraGestionController.mtoSaldoPromesa}" readonly="true" >
                                                        <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                                    </p:inputText>
                                                    <p:message for="txtNewSaldoPromesa" />

                                                    <p:outputLabel for="txtFechaPago" value="Fecha Pago" />
                                                    <p:calendar id="txtFechaPago" value="#{carteraGestionController.fechaPagoPromesa}" pattern="dd/MM/yyyy" immediate="true" />                                                        
                                                    <p:message for="txtFechaPago" />                                                   
                                                </h:panelGrid>

                                                <p:commandButton id="idGuardarArreglodepago" value="Generar" actionListener="#{carteraGestionController.agregarCancelacionTotal('CRC')}" process="@this idArreglodepago" update="tblPromesaArregloPago" />

                                                <p:dataTable id="tblPromesaArregloPago" value="#{carteraGestionController.promesaList}" var="promesa"
                                                             style="margin-bottom:20px"
                                                             emptyMessage="No se encontraron registros."
                                                             scrollable="true" rows="5"
                                                             widgetVar="tblPromesaArregloPago"
                                                             reflow="true" >

                                                    <p:column exportable="false">                                            
                                                        <p:commandButton class="warning-button rounded-button" icon="pi pi-trash" process="@this" oncomplete="PF('deletePromesaDialog').show()" >
                                                            <f:setPropertyActionListener value="#{promesa}" target="#{carteraGestionController.selectedPromesa}" />
                                                        </p:commandButton>
                                                    </p:column>
                                                    <p:column headerText="Teléfono" >
                                                        <h:outputText value="#{promesa.telefono}" />
                                                    </p:column>
                                                    <p:column headerText="Operación" >
                                                        <h:outputText value="#{promesa.operacion}" />
                                                    </p:column>

                                                    <p:column headerText="Tipo Descuento" >
                                                        <h:outputText value="#{promesa.tipodescuento}" />
                                                    </p:column>                                                    
                                                    <p:column headerText="Monto o %" >
                                                        <h:outputText value="#{promesa.mtoporcentaje}" />
                                                    </p:column>                                                    
                                                    <p:column headerText="Monto Promesa" >                                                
                                                        <h:outputText value="#{promesa.mtopago}" >
                                                            <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                                        </h:outputText>
                                                    </p:column>                                            
                                                    <p:column headerText="Fecha Pago" >
                                                        <h:outputText value="#{promesa.fechaPago}" >
                                                            <f:convertDateTime type="date" pattern="dd/MM/yyyy" />
                                                        </h:outputText>
                                                    </p:column>
                                                    <p:column headerText="Estado" >
                                                        <h:outputText value="#{promesa.estado}" />
                                                    </p:column>
                                                    <p:column headerText="Tipo Arreglo" >
                                                        <h:outputText value="#{promesa.tipoarreglopago}" />
                                                    </p:column>
                                                </p:dataTable>
                                            </p:tab>
                                            <p:tab id="idCancelacionTotalCuotas" title="Cancelación total por cuotas" >
                                                <h:panelGrid id="idArreglodepagoCTC" columns="3">
                                                    <p:outputLabel for="txtOperacionPromesaCTC" value="Operación" />
                                                    <h:selectOneMenu id="txtOperacionPromesaCTC" value="#{carteraGestionController.clienteOperacion}" style="width:100%" >
                                                        <f:selectItem itemLabel="----------------------------------------" itemValue="" noSelectionOption="true" />
                                                        <f:selectItems value="#{carteraGestionController.carteraList}" var="carteraList" itemLabel="#{carteraList.numeroCuenta}" itemValue="#{carteraList.numeroCuenta}" />
                                                        <p:ajax listener="#{carteraGestionController.onOperacionPromesaChange()}" event="change" update="txtSaldoOperacionCTC, tblPromesaArregloPagoCTC" process="@this :formGestion:idTabView:pgDeudor" />
                                                    </h:selectOneMenu>
                                                    <p:message for="txtOperacionPromesaCTC" />

                                                    <p:outputLabel for="txtSaldoOperacionCTC" value="Saldo" />
                                                    <h:outputText id="txtSaldoOperacionCTC" value="#{carteraGestionController.mtoSaldoOperacion}" >
                                                        <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                                    </h:outputText>
                                                    <p:message for="txtSaldoOperacionCTC" />

                                                    <p:outputLabel for="txtTipoDescuentoCTC" value="Tipo Descuento" />
                                                    <h:selectOneMenu id="txtTipoDescuentoCTC" value="#{carteraGestionController.tipoDescuentoPromesa}" style="width:100%" >
                                                        <f:selectItem itemLabel="----------------------------------------" itemValue="" noSelectionOption="true" />
                                                        <f:selectItem itemLabel="Monto Fijo" itemValue="FIJ"/>
                                                        <f:selectItem itemLabel="Porcentaje" itemValue="POR"/>
                                                        <p:ajax listener="#{carteraGestionController.calcNuevoMontoSegunDescuento()}" event="change" update="txtNewSaldoPromesaCTC" process="@this" />
                                                    </h:selectOneMenu>
                                                    <p:message for="txtTipoDescuentoCTC" />

                                                    <p:outputLabel for="txtDescuentoPromesaCTC" value="Monto o %" />
                                                    <p:inputNumber id="txtDescuentoPromesaCTC" value="#{carteraGestionController.mtoDescuentoPromesa}" decimalSeparator="." thousandSeparator="," decimalPlaces="2" maxlength="18" required="true" requiredMessage="Monto o % requerido!">
                                                        <p:ajax event="blur" update="txtNewSaldoPromesaCTC" listener="#{carteraGestionController.calcNuevoMontoSegunDescuento()}"/>
                                                    </p:inputNumber>
                                                    <p:message for="txtDescuentoPromesaCTC" />

                                                    <p:outputLabel for="txtNewSaldoPromesaCTC" value="Monto Promesa" />
                                                    <p:inputText id="txtNewSaldoPromesaCTC" value="#{carteraGestionController.mtoSaldoPromesa}" readonly="true" >
                                                        <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                                    </p:inputText>
                                                    <p:message for="txtNewSaldoPromesaCTC" />

                                                    <p:outputLabel for="txtFechaPagoCTC" value="Fecha Pago" />
                                                    <p:calendar id="txtFechaPagoCTC" value="#{carteraGestionController.fechaPagoPromesa}" pattern="dd/MM/yyyy" immediate="true" />
                                                    <p:message for="txtFechaPagoCTC" />

                                                    <p:outputLabel for="txtCuotasCTC" value="Cuotas" />
                                                    <h:selectOneMenu id="txtCuotasCTC" value="#{carteraGestionController.cuotas}" style="width:100%" >
                                                        <f:selectItem itemLabel="----------------------------------------" itemValue="" noSelectionOption="true" />
                                                        <f:selectItem itemLabel="Dos" itemValue="002"/>
                                                        <f:selectItem itemLabel="Tres" itemValue="003"/>
                                                    </h:selectOneMenu>
                                                    <p:message for="txtCuotasCTC" />
                                                </h:panelGrid>

                                                <p:commandButton id="idGuardarArreglodepagoCTC" value="Generar" actionListener="#{carteraGestionController.agregarCancelacionTotalPorCuotas('CRC')}" process="@this idArreglodepagoCTC" update="tblPromesaArregloPagoCTC" />

                                                <p:dataTable id="tblPromesaArregloPagoCTC" value="#{carteraGestionController.promesaList}" var="promesa"
                                                             style="margin-bottom:20px"
                                                             emptyMessage="No se encontraron registros."
                                                             scrollable="true" rows="5"                                                             
                                                             widgetVar="tblPromesaArregloPagoCTC"
                                                             reflow="true"
                                                             editable="true">

                                                    <p:ajax event="rowEdit" listener="#{carteraGestionController.onRowEdit}" update="formGestion:msgsArregloPago" />
                                                    <p:ajax event="rowEditCancel" listener="#{carteraGestionController.onRowCancel}" update="formGestion:msgsArregloPago" />

                                                    <p:column headerText="Teléfono" >
                                                        <h:outputText value="#{promesa.telefono}" />
                                                    </p:column>
                                                    <p:column headerText="Operación" >
                                                        <h:outputText value="#{promesa.operacion}" />
                                                    </p:column>

                                                    <p:column headerText="Tipo Descuento" >
                                                        <h:outputText value="#{promesa.tipodescuento}" />
                                                    </p:column>                                                    
                                                    <p:column headerText="Monto o %" >
                                                        <h:outputText value="#{promesa.mtoporcentaje}" />
                                                    </p:column>
                                                    <p:column headerText="Fecha Pago" >
                                                        <p:cellEditor>
                                                            <f:facet name="output">
                                                                <h:outputText value="#{promesa.fechaPago}" >
                                                                    <f:convertDateTime type="date" pattern="dd/MM/yyyy" />
                                                                </h:outputText>
                                                            </f:facet>
                                                            <f:facet name="input">
                                                                <p:calendar value="#{promesa.fechaPago}" pattern="dd/MM/yyyy" style="width:100%" />
                                                            </f:facet>
                                                        </p:cellEditor>
                                                    </p:column>
                                                    <p:column headerText="Monto Promesa" >
                                                        <p:cellEditor>
                                                            <f:facet name="output">
                                                                <h:outputText value="#{promesa.mtopago}" >
                                                                    <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                                                </h:outputText>                                                            
                                                            </f:facet>
                                                            <f:facet name="input">
                                                                <p:inputNumber value="#{promesa.mtopago}" symbol="₡" symbolPosition="p" decimalSeparator="." thousandSeparator="," decimalPlaces="2" maxlength="18" style="width:100%" required="true" requiredMessage="Monto requerido!" >                                                                    
                                                                    <p:ajax listener="#{carteraGestionController.recalcularCuotas(promesa.operacion,promesa.mtopago,promesa.fechaPago)}" event="change" update="tblPromesaArregloPagoCTC" />
                                                                </p:inputNumber>
                                                            </f:facet>
                                                        </p:cellEditor>
                                                    </p:column>
                                                    <p:column headerText="Estado" >
                                                        <h:outputText value="#{promesa.estado}" />
                                                    </p:column>
                                                    <p:column headerText="Tipo Arreglo" >
                                                        <h:outputText value="#{promesa.tipoarreglopago}" />
                                                    </p:column>
                                                    <p:column style="width:32px">
                                                        <p:rowEditor />
                                                    </p:column>
                                                </p:dataTable>
                                            </p:tab>
                                            <p:tab id="idRefinanciamiento" title="Refinanciamiento" >
                                                <p:panelGrid columns="1" layout="grid">
                                                    <h:panelGrid id="idArreglodepagoREF" columns="3">
                                                        <p:outputLabel for="txtOperacionPromesaREF" value="Operación" />
                                                        <h:selectOneMenu id="txtOperacionPromesaREF" value="#{carteraGestionController.clienteOperacion}" style="width:100%" >
                                                            <f:selectItem itemLabel="----------------------------------------" itemValue="" noSelectionOption="true" />
                                                            <f:selectItems value="#{carteraGestionController.carteraList}" var="cartera" itemLabel="#{cartera.numeroCuenta}" itemValue="#{cartera.numeroCuenta}" />
                                                            <p:ajax listener="#{carteraGestionController.onOperacionPromesaChange()}" event="change" update="txtSaldoOperacionREF, tblPromesaArregloPagoREF" process="@this" />
                                                        </h:selectOneMenu>
                                                        <p:message for="txtOperacionPromesaREF" />

                                                        <p:outputLabel for="txtSaldoOperacionREF" value="Saldo" />
                                                        <h:outputText id="txtSaldoOperacionREF" value="#{carteraGestionController.mtoSaldoOperacion}" >
                                                            <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" /> 
                                                        </h:outputText>
                                                        <p:message for="txtSaldoOperacionREF" />

                                                        <p:outputLabel for="txtDescuentoPromesaREF" value="Primer Tracto" />
                                                        <p:inputNumber id="txtDescuentoPromesaREF" value="#{carteraGestionController.mtoDescuentoPromesa}" symbol="₡" symbolPosition="p" decimalSeparator="." thousandSeparator="," decimalPlaces="2" maxlength="18" required="true" requiredMessage="Primer Tracto!">
                                                            <p:ajax event="blur" listener="#{carteraGestionController.calcSaldoRestanteREF()}" update="txtNewSaldoPromesaREF"/>
                                                        </p:inputNumber>
                                                        <p:message for="txtDescuentoPromesaREF" />

                                                        <p:outputLabel for="txtNewSaldoPromesaREF" value="Saldo restante" />
                                                        <p:inputText id="txtNewSaldoPromesaREF" value="#{carteraGestionController.mtoSaldoPromesa}" readonly="true">
                                                            <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                                        </p:inputText>
                                                        <p:message for="txtNewSaldoPromesaREF" />

                                                        <p:outputLabel for="txtFechaPagoREF" value="Fecha Pago Inicial" />
                                                        <p:calendar id="txtFechaPagoREF" value="#{carteraGestionController.fechaPagoPromesa}" pattern="dd/MM/yyyy" immediate="true" />                                                        
                                                        <p:message for="txtFechaPagoREF" />

                                                        <p:outputLabel for="txtCuotasREF" value="Cuotas" />
                                                        <h:selectOneMenu id="txtCuotasREF" value="#{carteraGestionController.cuotas}" style="width:100%" >
                                                            <f:selectItem itemLabel="----------------------------------------" itemValue="" noSelectionOption="true" />
                                                            <f:selectItem itemLabel="Seis (06)" itemValue="006"/>
                                                            <f:selectItem itemLabel="Doce (12)" itemValue="012"/>                                                        
                                                            <f:selectItem itemLabel="Dieciocho (18)" itemValue="018"/>
                                                            <f:selectItem itemLabel="VeintiCuatro (24)" itemValue="024"/>
                                                            <f:selectItem itemLabel="Treinta (30)" itemValue="030"/>
                                                            <f:selectItem itemLabel="Treinta y Seis (36)" itemValue="036"/>
                                                            <f:selectItem itemLabel="Cuarenta Y Dos (42)" itemValue="042"/>
                                                            <f:selectItem itemLabel="Cuarenta Y Ocho (48)" itemValue="048"/>
                                                        </h:selectOneMenu>
                                                        <p:message for="txtCuotasREF" />                                                   
                                                    </h:panelGrid>
                                                    <p:panelGrid id="btpgArregloPago" columns="2" layout="grid">
                                                        <p:commandButton id="idGuardarArreglodepagoREF" value="Generar" actionListener="#{carteraGestionController.agregarRefinanciamiento('CRC')}" process="@this idArreglodepagoREF" update="tblPromesaArregloPagoREF" />
                                                        <p:commandButton id="idBorrarArregloPago" value="Limpiar" actionListener="#{carteraGestionController.deleteArregloPago()}" process="@this idArreglodepagoREF" update="tblPromesaArregloPagoREF" />
                                                    </p:panelGrid>
                                                </p:panelGrid>


                                                <p:dataTable id="tblPromesaArregloPagoREF" value="#{carteraGestionController.promesaList}" var="promesa"
                                                             style="margin-bottom:20px"
                                                             emptyMessage="No se encontraron registros."
                                                             scrollable="true" rows="5"
                                                             paginator="true" paginatorPosition="top"
                                                             widgetVar="tblPromesaArregloPagoREF"
                                                             reflow="true"
                                                             editable="true" >

                                                    <p:ajax event="rowEdit" listener="#{carteraGestionController.onRowEdit}" update="formGestion:msgsArregloPago" />
                                                    <p:ajax event="rowEditCancel" listener="#{carteraGestionController.onRowCancel}" update="formGestion:msgsArregloPago" />

                                                    <p:column headerText="Teléfono" >
                                                        <h:outputText value="#{promesa.telefono}" />
                                                    </p:column>
                                                    <p:column headerText="Operación" >
                                                        <h:outputText value="#{promesa.operacion}" />
                                                    </p:column>

                                                    <p:column headerText="Tipo Descuento" >
                                                        <h:outputText value="#{promesa.tipodescuento}" />
                                                    </p:column>                                                    
                                                    <p:column headerText="Monto o %" >
                                                        <h:outputText value="#{promesa.mtoporcentaje}" />
                                                    </p:column>
                                                    <p:column headerText="Monto Promesa" >
                                                        <p:cellEditor>
                                                            <f:facet name="output">
                                                                <h:outputText value="#{promesa.mtopago}" >
                                                                    <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                                                </h:outputText>                                                            
                                                            </f:facet>
                                                            <f:facet name="input">
                                                                <p:inputNumber value="#{promesa.mtopago}" symbol="₡" symbolPosition="p" decimalSeparator="." thousandSeparator="," decimalPlaces="2" maxlength="18" style="width:100%" required="true" requiredMessage="Monto requerido!" />
                                                            </f:facet>
                                                        </p:cellEditor>
                                                    </p:column>                                                    
                                                    <p:column headerText="Fecha Pago" >
                                                        <p:cellEditor>
                                                            <f:facet name="output">
                                                                <h:outputText value="#{promesa.fechaPago}" >
                                                                    <f:convertDateTime type="date" pattern="dd/MM/yyyy" />
                                                                </h:outputText>
                                                            </f:facet>
                                                            <f:facet name="input">
                                                                <p:calendar value="#{promesa.fechaPago}" pattern="dd/MM/yyyy" style="width:100%" />
                                                            </f:facet>
                                                        </p:cellEditor>
                                                    </p:column>
                                                    <p:column headerText="Estado" >
                                                        <h:outputText value="#{promesa.estado}" />
                                                    </p:column>
                                                    <p:column headerText="Tipo Arreglo" >
                                                        <h:outputText value="#{promesa.tipoarreglopago}" />
                                                    </p:column>
                                                    <p:column style="width:32px">
                                                        <p:rowEditor />
                                                    </p:column>
                                                </p:dataTable>
                                            </p:tab>
                                            <p:tab id="idPagoParcial" title="Pago Parcial">
                                                <p:panelGrid columns="1" layout="grid">
                                                    <h:panelGrid id="idArreglodepagoPAP" columns="3">
                                                        <p:outputLabel for="txtOperacionPromesaPAP" value="Operación" />
                                                        <h:selectOneMenu id="txtOperacionPromesaPAP" value="#{carteraGestionController.clienteOperacion}" style="width:100%" >
                                                            <f:selectItem itemLabel="----------------------------------------" itemValue="" noSelectionOption="true" />
                                                            <f:selectItems value="#{carteraGestionController.carteraList}" var="cartera" itemLabel="#{cartera.numeroCuenta}" itemValue="#{cartera.numeroCuenta}" />
                                                            <p:ajax listener="#{carteraGestionController.onOperacionPromesaChange()}" event="change" update="txtSaldoOperacionPAP, tblPromesaArregloPagoPAP" process="@this" />
                                                        </h:selectOneMenu>
                                                        <p:message for="txtOperacionPromesaPAP" />

                                                        <p:outputLabel for="txtSaldoOperacionPAP" value="Saldo" />
                                                        <h:outputText id="txtSaldoOperacionPAP" value="#{carteraGestionController.mtoSaldoOperacion}">
                                                            <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" /> 
                                                        </h:outputText>
                                                        <p:message for="txtSaldoOperacionPAP" />                                                    

                                                        <p:outputLabel for="txtNewSaldoPromesaPAP" value="Monto Promesa" />
                                                        <p:inputNumber id="txtNewSaldoPromesaPAP" value="#{carteraGestionController.mtoSaldoPromesa}" symbol="₡" symbolPosition="p" decimalSeparator="." thousandSeparator="," decimalPlaces="2" maxlength="18" required="true" requiredMessage="Monto Promesa!"/>
                                                        <p:message for="txtNewSaldoPromesaPAP" />

                                                        <p:outputLabel for="txtFechaPagoPAP" value="Fecha Pago" />
                                                        <p:calendar id="txtFechaPagoPAP" value="#{carteraGestionController.fechaPagoPromesa}" pattern="dd/MM/yyyy" immediate="true" />
                                                        <p:message for="txtFechaPagoPAP" />
                                                    </h:panelGrid>
                                                    <p:panelGrid id="btpgArregloPagoPAP" columns="2" layout="grid">
                                                        <p:commandButton id="idGuardarArreglodepagoPAP" value="Generar" actionListener="#{carteraGestionController.agregarPagoParcial('CRC')}" process="@this idArreglodepagoPAP" update="tblPromesaArregloPagoPAP" />
                                                        <p:commandButton id="idBorrarArregloPagoPAP" value="Limpiar" actionListener="#{carteraGestionController.deleteArregloPago()}" process="@this idArreglodepagoPAP" update="tblPromesaArregloPagoPAP" />
                                                    </p:panelGrid>
                                                </p:panelGrid>

                                                <p:dataTable id="tblPromesaArregloPagoPAP" value="#{carteraGestionController.promesaList}" var="promesa"
                                                             style="margin-bottom:20px"
                                                             emptyMessage="No se encontraron registros."
                                                             scrollable="true" rows="5"                                                             
                                                             widgetVar="tblPromesaArregloPagoPAP"
                                                             reflow="true"
                                                             editable="true">                                                    

                                                    <p:column exportable="false">
                                                        <p:commandButton class="warning-button rounded-button" icon="pi pi-trash" process="@this" oncomplete="PF('deletePromesaDialog').show()" >
                                                            <f:setPropertyActionListener value="#{promesa}" target="#{carteraGestionController.selectedPromesa}" />
                                                        </p:commandButton>
                                                    </p:column>
                                                    <p:column headerText="Teléfono" >
                                                        <h:outputText value="#{promesa.telefono}" />
                                                    </p:column>
                                                    <p:column headerText="Operación" >
                                                        <h:outputText value="#{promesa.operacion}" />
                                                    </p:column>
                                                    <p:column headerText="Tipo Descuento" >
                                                        <h:outputText value="#{promesa.tipodescuento}" />
                                                    </p:column>
                                                    <p:column headerText="Monto o %" >
                                                        <h:outputText value="#{promesa.mtoporcentaje}" />
                                                    </p:column>
                                                    <p:column headerText="Monto Promesa" >
                                                        <h:outputText value="#{promesa.mtopago}" >
                                                            <f:convertNumber type="currency" currencySymbol="₡" maxFractionDigits="2" locale="en-US" groupingUsed="true" />
                                                        </h:outputText>
                                                    </p:column>
                                                    <p:column headerText="Fecha primer pago" >
                                                        <h:outputText value="#{promesa.fechaPago}" >
                                                            <f:convertDateTime type="date" pattern="dd/MM/yyyy" />
                                                        </h:outputText>
                                                    </p:column>
                                                    <p:column headerText="Estado" >
                                                        <h:outputText value="#{promesa.estado}" />
                                                    </p:column>
                                                    <p:column headerText="Tipo Arreglo" >
                                                        <h:outputText value="#{promesa.tipoarreglopago}" />
                                                    </p:column>
                                                </p:dataTable>
                                            </p:tab>
                                        </p:tabView>
                                    </p:fieldset>                                
                                </div>
                            </p:outputPanel>
                        </p:outputPanel>
                        <f:facet name="footer">
                            <p:commandButton value="Cerrar" icon="pi pi-check" update="manage-llamarPromesaArregloPago-content" process="manage-llamarPromesaArregloPago-content @this" onclick="PF('manageLlamarPromesaArregloPagoDialog').hide()" />                                        
                        </f:facet>
                    </p:dialog>

                    <p:confirmDialog widgetVar="deletePromesaDialog" showEffect="fade" width="300" message="Eliminar esta promesa?" header="Confirmar" severity="warn">
                        <p:commandButton value="Si" icon="pi pi-check" actionListener="#{carteraGestionController.deletePromesa}" process="@this" oncomplete="PF('deletePromesaDialog').hide()" update="formGestion:idtabViewPromesa:tblPromesaArregloPago,formGestion:idtabViewPromesa:tblPromesaArregloPagoCTC"/>
                        <p:commandButton value="No" type="button" styleClass="secondary-button" icon="pi pi-times" onclick="PF('deletePromesaDialog').hide()" />
                    </p:confirmDialog>
                </div>
            </div>
        </h:form>
    </ui:define>
</ui:composition>